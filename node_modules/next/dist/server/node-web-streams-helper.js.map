{"version":3,"sources":["../../src/server/node-web-streams-helper.ts"],"names":["encodeText","decodeText","streamToBufferedResult","readableStreamTee","chainStreams","streamFromArray","streamToString","createBufferedTransformStream","createInsertedHTMLStream","renderToInitialStream","createDeferredSuffixStream","createInlineDataStream","createSuffixStream","createRootLayoutValidatorStream","continueFromInitialStream","queueTask","process","env","NEXT_RUNTIME","globalThis","setTimeout","setImmediate","input","TextEncoder","encode","textDecoder","decode","stream","renderResult","renderChunks","TextDecoder","writable","write","chunk","push","end","destroy","pipe","join","readable","transformStream","TransformStream","transformStream2","writer","getWriter","writer2","reader","getReader","read","then","done","value","close","streams","promise","Promise","resolve","i","length","pipeTo","preventClose","strings","forEach","str","bufferedString","transform","v","pendingFlush","flushBuffer","controller","buffered","enqueue","flush","getServerInsertedHTML","insertedHTMLChunk","ReactDOMServer","element","streamOptions","getTracer","trace","AppRenderSpan","renderToReadableStream","createHeadInsertionTransformStream","insert","inserted","freezing","insertion","content","index","indexOf","insertedHeadContent","slice","suffix","suffixFlushed","suffixFlushTask","res","dataStream","dataStreamFinished","dataStreamReader","err","error","assetPrefix","getTree","foundHtml","foundBody","includes","missingTags","filter","nonNullable","JSON","stringify","tree","renderStream","generateStaticHTML","serverInsertedHTMLToHead","validateRootLayout","closeTag","suffixUnclosed","split","allReady","transforms","serverInsertedHTML","reduce","pipeThrough"],"mappings":"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"}