{"version":3,"sources":["../../src/server/node-web-streams-helper.ts"],"names":["nonNullable","getTracer","AppRenderSpan","queueTask","process","env","NEXT_RUNTIME","globalThis","setTimeout","setImmediate","encodeText","input","TextEncoder","encode","decodeText","textDecoder","decode","stream","streamToBufferedResult","renderResult","renderChunks","TextDecoder","writable","write","chunk","push","end","destroy","pipe","join","readableStreamTee","readable","transformStream","TransformStream","transformStream2","writer","getWriter","writer2","reader","getReader","read","then","done","value","close","chainStreams","streams","promise","Promise","resolve","i","length","pipeTo","preventClose","streamFromArray","strings","forEach","str","streamToString","bufferedString","createBufferedTransformStream","transform","v","pendingFlush","flushBuffer","controller","buffered","enqueue","flush","createInsertedHTMLStream","getServerInsertedHTML","insertedHTMLChunk","renderToInitialStream","ReactDOMServer","element","streamOptions","trace","renderToReadableStream","createHeadInsertionTransformStream","insert","inserted","freezing","insertion","content","index","indexOf","insertedHeadContent","slice","createDeferredSuffixStream","suffix","suffixFlushed","suffixFlushTask","res","createInlineDataStream","dataStream","dataStreamFinished","dataStreamReader","err","error","createSuffixStream","createRootLayoutValidatorStream","assetPrefix","getTree","foundHtml","foundBody","includes","missingTags","filter","JSON","stringify","tree","continueFromInitialStream","renderStream","generateStaticHTML","serverInsertedHTMLToHead","validateRootLayout","closeTag","suffixUnclosed","split","allReady","transforms","serverInsertedHTML","reduce","pipeThrough"],"mappings":"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"}